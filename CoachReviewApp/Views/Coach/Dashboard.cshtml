@model CoachReviewApp.Models.Coach
@{
    ViewData["Title"] = "Coach Dashboard";
}

<div class="row">
    <div class="col-md-12">
        <h2>@ViewData["Title"]</h2>
        <p class="lead">Welcome, @Model.Name!</p>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Total Reviews</h5>
                <p class="display-4">@Model.TotalReviews</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Average Rating</h5>
                <p class="display-4">@Model.AverageRating.ToString("0.0")</p>
                <div>
                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= Math.Round(Model.AverageRating))
                        {
                            <span class="text-warning fs-4">★</span>
                        }
                        else
                        {
                            <span class="text-secondary fs-4">☆</span>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <h5 class="card-title">Subscription Plan</h5>
                <p class="fs-3">@Model.SubscriptionTier.Name</p>
                <p class="text-muted">$@Model.SubscriptionTier.Price/month</p>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12 mb-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Profile Information</h5>
                <p><strong>Specialization:</strong> @Model.Specialization</p>
                <p><strong>Location:</strong> @Model.City, @Model.State @Model.ZipCode</p>
                <p><strong>Experience:</strong> @Model.YearsOfExperience years</p>
                <a asp-action="Edit" class="btn btn-primary">Edit Profile</a>
                <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-secondary">View Public Profile</a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <h4>Recent Reviews from Clients</h4>
        @if (!Model.Reviews.Any())
        {
            <div class="alert alert-info">You haven't received any reviews yet.</div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Reviewer</th>
                            <th>Rating</th>
                            <th>Comment</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var review in Model.Reviews.OrderByDescending(r => r.CreatedAt).Take(10))
                        {
                            <tr>
                                <td>@review.CreatedAt.ToString("MMM dd, yyyy")</td>
                                <td>
                                    @if (Model.SubscriptionTier.CanViewClientContacts)
                                    {
                                        @review.User.FirstName @review.User.LastName
                                        <br />
                                        <small class="text-muted">@review.User.Email</small>
                                    }
                                    else
                                    {
                                        <span class="text-muted">Anonymous</span>
                                        <br />
                                        <small>(Upgrade to view contacts)</small>
                                    }
                                </td>
                                <td>
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= review.Rating)
                                        {
                                            <span class="text-warning">★</span>
                                        }
                                        else
                                        {
                                            <span class="text-secondary">☆</span>
                                        }
                                    }
                                </td>
                                <td>@review.Comment</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-12">
        <div class="card bg-light">
            <div class="card-body">
                <h5 class="card-title">Subscription Benefits</h5>
                <ul>
                    <li><strong>Max Reviews:</strong> @(Model.SubscriptionTier.MaxReviews == -1 ? "Unlimited" : Model.SubscriptionTier.MaxReviews.ToString())</li>
                    <li><strong>View Client Contacts:</strong> @(Model.SubscriptionTier.CanViewClientContacts ? "Yes" : "No - Upgrade to Professional or Elite")</li>
                    <li><strong>Featured Listing:</strong> @(Model.SubscriptionTier.FeaturedListing ? "Yes" : "No - Upgrade to Elite")</li>
                </ul>
                @if (Model.SubscriptionTier.Id < 3)
                {
                    <p class="text-muted">Consider upgrading your plan to unlock more features!</p>
                }
            </div>
        </div>
    </div>
</div>
